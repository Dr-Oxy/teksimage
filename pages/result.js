import Head from 'next/head';
import Image from 'next/image';
import Link from 'next/link';
import { useContext, useState } from 'react';

import { AppContext } from '../utils/AppContext';

import { saveAs } from 'file-saver';

export default function Result() {
  const { results, prompt } = useContext(AppContext);

  const [focusImg, setFocusImg] = useState({
    b64_json: results[0]?.b64_json,
    liked: false,
  });
  const [isLiked, setIsLiked] = useState(false);

  const changeFocus = (item) => {
    setFocusImg({
      b64_json: item.b64_json,
    });
  };

  const downloadImage = () => {
    saveAs(
      `data:image/png;base64,${focusImg.b64_json}`,
      `${prompt?.substr(0, 20)}.png`,
    );
  };

  return (
    <div>
      <Head>
        <title>TeksImage - Result</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="min-h-screen flex flex-col items-center justify-center">
        <section className="max-w-[960px] mx-auto mt-8 px-4 lg:px-0 grid grid-cols-1 lg:grid-cols-2 gap-8">
          {results?.length !== 0 ? (
            <article className="grid grid-cols-6 gap-4">
              {results?.map((item, index) => (
                <div
                  onClick={() => changeFocus(item)}
                  key={index}
                  className={`cursor-pointer bg-gray-100 ${
                    focusImg.b64_json === item.b64_json
                      ? 'border-4 border-blue-500'
                      : ''
                  }`}
                >
                  <Image
                    className=""
                    src={`data:image/png;base64,${item.b64_json}`}
                    alt={`${index} open ai generated image`}
                    height={512}
                    width={512}
                  />
                </div>
              ))}
            </article>
          ) : (
            ''
          )}
        </section>

        <div className=" max-w-[960px] mx-auto mt-8 px-4 lg:px-0 grid grid-cols-1 lg:grid-cols-2 gap-8">
          <section>
            <div className="cursor-pointer bg-gray-100 shadow-md">
              <Image
                className=""
                src={`data:image/png;base64,${focusImg.b64_json}`}
                alt={`open ai generated image`}
                height={512}
                width={512}
              />
            </div>

            <div className="mt-5 flex items-center justify-end">
              <button
                onClick={() =>
                  setFocusImg({
                    ...focusImg,
                    liked: !focusImg.liked,
                  })
                }
                className="py-2 px-4 w-fit flex items-center text-[#636363] text-sm  capitalize rounded 
              bg-[#EDEDED]"
              >
                <svg
                  width="14"
                  height="12"
                  viewBox="0 0 14 12"
                  fill={focusImg?.liked ? 'red' : 'none'}
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M4.20833 0.994126C2.43646 0.994126 1 2.43058 1 4.20246C1 7.41079 4.79167 10.3275 6.83333 11.0059C8.875 10.3275 12.6667 7.41079 12.6667 4.20246C12.6667 2.43058 11.2302 0.994126 9.45833 0.994126C8.37333 0.994126 7.41375 1.53283 6.83333 2.35738C6.53749 1.93598 6.14446 1.59207 5.68753 1.35477C5.2306 1.11747 4.72321 0.993762 4.20833 0.994126Z"
                    stroke="#636363"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>

                <span className="ml-2">
                  {focusImg.liked ? 'Liked' : 'like'}
                </span>
              </button>

              <button
                onClick={() => setIsLiked(!isLiked)}
                className="ml-6 py-2 px-4 w-fit flex items-center text-[#636363] text-sm  capitalize rounded 
              bg-[#EDEDED]"
              >
                <svg
                  width="9"
                  height="10"
                  viewBox="0 0 9 10"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6.9165 6.71667C6.59984 6.71667 6.3165 6.84167 6.09984 7.0375L3.129 5.30833C3.14984 5.2125 3.1665 5.11667 3.1665 5.01667C3.1665 4.91667 3.14984 4.82083 3.129 4.725L6.0665 3.0125C6.2915 3.22083 6.58734 3.35 6.9165 3.35C7.60817 3.35 8.1665 2.79167 8.1665 2.1C8.1665 1.40833 7.60817 0.849998 6.9165 0.849998C6.22484 0.849998 5.6665 1.40833 5.6665 2.1C5.6665 2.2 5.68317 2.29583 5.704 2.39167L2.7665 4.10417C2.5415 3.89583 2.24567 3.76667 1.9165 3.76667C1.22484 3.76667 0.666504 4.325 0.666504 5.01667C0.666504 5.70833 1.22484 6.26667 1.9165 6.26667C2.24567 6.26667 2.5415 6.1375 2.7665 5.92917L5.73317 7.6625C5.71234 7.75 5.69984 7.84167 5.69984 7.93333C5.69984 8.60417 6.24567 9.15 6.9165 9.15C7.58734 9.15 8.13317 8.60417 8.13317 7.93333C8.13317 7.2625 7.58734 6.71667 6.9165 6.71667Z"
                    fill="#636363"
                  />
                </svg>

                <span className="ml-2">share</span>
              </button>
            </div>
          </section>

          <section>
            <p className="text-[#444] text-sm lg:text-base w-full mb-10">
              {prompt}
            </p>
            {/* 
            <a href={`data:image/png;base64,${focusImg.b64_json}`} download> */}
            <button
              onClick={downloadImage}
              className="p-3 text-white text-sm w-full mx-auto capitalize rounded-md 
              bg-[#177AE5]"
            >
              download
            </button>
            {/* </a> */}

            <Link href="/">
              <button
                className="p-3 mt-4 text-black text-sm w-full mx-auto capitalize rounded-md 
              bg-transparent"
              >
                go back
              </button>
            </Link>
          </section>
        </div>
      </main>
    </div>
  );
}
